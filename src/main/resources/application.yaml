server:
  port: 8080

spring:
  application:
    name: book-embedding-worker

  datasource:
    url: ${POSTGRESQL_URL}
    username: ${POSTGRESQL_USERNAME}
    password: ${POSTGRESQL_PASSWORD}
    driver-class-name: org.postgresql.Driver

    hikari:
      maximum-pool-size: 3    # DB Health Check 고려
      minimum-idle: 1

      # NAT idle(350s)
      max-lifetime: 300000  # 5분
      idle-timeout: 180000  # 3분
      keepalive-time: 60000 # 1분

      connection-timeout: 10000
      validation-timeout: 3000
      
      data-source-properties:
        ApplicationName: book-embedding-worker-${HOSTNAME:localhost}

  cloud:
    gcp:
      project-id: ${GCP_PROJECT_ID}
      location: us-central1
      model: gemini-embedding-001

  ai:
    vectorstore:
      opensearch:
        uris: ${OPENSEARCH_URIS}
        username: ${OPENSEARCH_USERNAME}
        password: ${OPENSEARCH_PASSWORD}
        index-name: book-embedding-index
        initialize-schema: true
        similarity-function: cosinesimil
        use-approximate-knn: true
        dimensions: 768
        read-timeout: 5000
        connect-timeout: 60000

resilience4j:
  ratelimiter:
    instances:
      embeddingRateLimiter:
        limitForPeriod: 1       # 주기 당 허용 횟수
        limitRefreshPeriod: 12s  # 주기 = 1분
        timeoutDuration: 12s

management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus
        exclude: env, heapdump,beans,loggers
      base-path: /internal
  endpoint:
    health:
      show-details: never
    prometheus:
      access: read_only
  metrics:
    tags:
      application: ${spring.application.name}
