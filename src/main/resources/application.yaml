server:
  port: 8080

spring:
  application:
    name: book-embedding-worker

  datasource:
    url: ${POSTGRESQL_URL}
    username: ${POSTGRESQL_USERNAME}
    password: ${POSTGRESQL_PASSWORD}
    driver-class-name: org.postgresql.Driver

    hikari:
      maximum-pool-size: 2
      max-lifetime: 1700000   # 28 ~ 29분
      keepalive-time: 0
      data-source-properties:
        ApplicationName: book-embedding-worker-${HOSTNAME:localhost}

  ai:
    vertex:
      ai:
        embedding:
          project-id: ${GCP_PROJECT_ID}
          location: us-central1
    vectorstore:
      opensearch:
        uris: ${OPENSEARCH_URIS}
        username: ${OPENSEARCH_USERNAME}
        password: ${OPENSEARCH_PASSWORD}
        index-name: book-embedding-index
        initialize-schema: true
        similarity-function: cosinesimil
        use-approximate-knn: true
        dimensions: 768
        read-timeout: 5000
        connect-timeout: 60000

resilience4j:
  ratelimiter:
    instances:
      embeddingRateLimiter:
        limitForPeriod: 5       # 주기 당 허용 횟수
        limitRefreshPeriod: 1m  # 주기 = 1분
        timeoutDuration: 1m

management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus
        exclude: env, heapdump,beans,loggers
      base-path: /internal
  endpoint:
    health:
      show-details: never
    prometheus:
      access: read_only
  metrics:
    tags:
      application: ${spring.application.name}
